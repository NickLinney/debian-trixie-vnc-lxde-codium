# docker-compose.yml
services:
  desktop:
    build:
      context: .
      args:
        # Build-time passwords (pulled from .env; changing them requires a rebuild)
        USER_PASSWORD: ${USER_PASSWORD:-changeme}
        ROOT_PASSWORD: ${ROOT_PASSWORD:-changeme}

    container_name: debian-trixie-vnc-lxde-codium

    ports:
      # Network-ready: expose SSH for tunneling
      - "2222:22"

      # Optional (host-only direct VNC): connect from the Docker host without SSH.
      # This does NOT expose VNC to your LAN/WAN.
      - "127.0.0.1:5900:5900"

    # Load defaults from .env if present (install.sh will create it from sample.env)
    env_file:
      - .env

    # Runtime settings (environment values override env_file)
    environment:
      VNC_PASSWORD: ${VNC_PASSWORD:-changeme}
      VNC_GEOMETRY: ${VNC_GEOMETRY:-1920x1080}
      VNC_DEPTH: ${VNC_DEPTH:-24}

    # NOTE (Docker Desktop macOS/Windows):
    # This sysctl is not namespaced, so Docker Desktop will fail to start the container with:
    # "sysctl ... is not in a separate kernel namespace"
    #
    # On a Linux host, you can enable it on the host and/or re-enable this block.
    # sysctls:
    #   - kernel.unprivileged_userns_clone=1

    # Optional, but recommended for Electron apps / browsers
    shm_size: "512m"

    restart: unless-stopped
